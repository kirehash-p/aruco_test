# ArUco マーカーオーバーレイアプリケーション

このアプリケーションは、OpenCV.jsを使用してArUcoマーカーを検出し、マーカーの位置に画像を重ねて表示するWebアプリケーションです。カメラを使用して、現実空間に配置されたマーカーを認識し、その上に仮想的な画像を重ねる拡張現実（AR）体験を提供します。

## 使い方

1. アプリを起動すると、ブラウザがカメラへのアクセス許可を求めます。「許可」をクリックしてください。
2. カメラが起動し、画面にカメラからの映像が表示されます。
3. ArUcoマーカー（ID: 0, 1, 2, 3）を画面に表示すると、マーカーが検出され、その上に選択された画像が重ねて表示されます。
4. 画面左下の操作パネルから以下の設定が可能です：
   - **合成画像**: デフォルト画像またはアップロードした画像から選択できます。
   - **マーカー枠を表示**: チェックボックスをオン/オフすることで、検出されたマーカーの枠と ID の表示/非表示を切り替えられます。
   - **画像をアップロード**: お好みの画像をアップロードして、マーカー上に表示することができます。

## マーカーについて

このアプリケーションは、ArUcoマーカー（4x4, Dict 50）を使用しています。正しく動作させるためには、以下の4つのマーカーが必要です：

- ID 0: 左上に配置
- ID 1: 右上に配置
- ID 2: 右下に配置
- ID 3: 左下に配置

これら4つのマーカーが検出されると、その間の領域に選択された画像が透視変換されて表示されます。

### マーカーの生成

アプリケーションで使用するArUcoマーカーを生成するには、以下のPythonスクリプトを実行します：

```
python other/img.py
```

このコマンドを実行すると、以下のファイルが生成されます：

- `assets/markers/aruco_corners.png` - 4つのマーカーがすでに配置された1枚の画像
- `assets/markers/aruco_id_0.png` - 左上マーカー (ID 0)
- `assets/markers/aruco_id_1.png` - 右上マーカー (ID 1)
- `assets/markers/aruco_id_2.png` - 右下マーカー (ID 2)
- `assets/markers/aruco_id_3.png` - 左下マーカー (ID 3)

`aruco_corners.png` は4つのマーカーがすでに適切な位置に配置されているため、1枚印刷して使用するのが便利です。個別のマーカーが必要な場合は、個別の画像ファイルを印刷して、上記の配置に従ってマーカーを設置してください。

### マーカーの印刷と使用

1. 生成されたマーカー画像ファイルを印刷します
2. マーカーを平面に配置します（例：テーブルの上、壁など）
3. アプリケーションをカメラをマーカーに向け、すべてのマーカーが画面内に収まるようにします
4. マーカーが検出されると、その上に選択された画像が表示されます

## システム要件

- モダンなWebブラウザ（Google Chrome, Firefox, Safari, Microsoft Edge最新版推奨）
- カメラ付きデバイス（ノートPC、スマートフォン、タブレットなど）
- JavaScript有効設定
- マーカー生成には Python と OpenCV が必要です

## トラブルシューティング

- **カメラが起動しない**: ブラウザがカメラへのアクセスを許可しているか確認してください。
- **マーカーが検出されない**: 
  - マーカーの印刷が鮮明かつ十分な大きさであることを確認してください
  - 照明条件を改善し、マーカーに明るい光が当たるようにしてください
  - マーカーが画面内に収まっていることを確認してください
- **画像の表示が不安定**: マーカーをしっかりと固定し、手振れを最小限に抑えてください

## マーカーのカスタマイズ

`other/img.py` スクリプトの実行時に以下のようなパラメータをカスタマイズすることができます：

```python
# 複数マーカーを1枚の画像に配置
generate_aruco_corner_image(
    output_path="assets/markers/aruco_corners.png",  # 出力先
    image_size=(800, 600),                           # 画像サイズ
    marker_size=100,                                 # マーカーサイズ
    marker_ids=[0, 1, 2, 3],                         # マーカーID
    margin=50                                        # 余白
)

# 個別マーカーの生成
generate_individual_aruco_markers(
    output_dir="assets/markers",                     # 出力ディレクトリ
    marker_ids=[0, 1, 2, 3],                         # マーカーID
    marker_size=200,                                 # マーカーサイズ
    margin=50                                        # 余白
)
```

## 技術情報

- このアプリケーションはOpenCV.js（JavaScriptで動作するOpenCVライブラリ）を使用しています
- ArUcoマーカー検出アルゴリズムを利用し、マーカーの位置を特定しています
- 透視変換を適用して、検出されたマーカー平面上に画像を重ねて表示します
